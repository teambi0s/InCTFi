from os import path, remove
from time import sleep
from random import randint
from commands import getoutput

if(path.exists("/opt/actor/secret")):
    SECRET=open("/opt/actor/secret").read().strip()
else:
    SECRET='763'
client_secret = raw_input().strip()
client_secret = client_secret.replace("Secret: ",'')
if (SECRET == client_secret):
    data = raw_input()
    data = data.replace("----BEGINREQUEST----",'').replace("----ENDREQUEST----",'')
    reply = getoutput(data.decode("base64"))
    next_secret = str(randint(100,800))
    open("/opt/actor/secret",'w').write(next_secret)
    sleep(3)
    print("----BEGINRESPONSE----\n"+reply.encode("base64").replace("\n",'')+"\n----ENDRESPONSE----\n\n")
    print("Next Secret: "+next_secret)
else:
    print("Wrong Secret :(" )
    remove("/opt/actor/secret")
    open("/opt/actor/errors",'w').write("Wrong Secret Encountered "+ client_secret + " was sent!!")