#!/bin/bash
set -x
server="updates.safextractor.lan"
path="/uploads/packages/"

download () {
    server=$1
    path=$2
    mkdir -p /tmp/packagebuild && cd /tmp/packagebuild
    wget -r -np -R "index.html*" http://$1$2
}

install_pkg () {
    server=$1
    path=$2
    cd /tmp/packagebuild/$server$path
    for i in $(ls); do dpkg -i $i || true; done   
}

nc -z $server 80

if [ $? == 1 ]
then
    echo "Server Not Reachable!"
    exit 1
else
    download $server $path
    install_pkg $server $path
fi
