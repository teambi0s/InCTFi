FROM ubuntu:18.04 as build

RUN apt update; apt -y --autoremove full-upgrade
RUN apt -y install python3 python3-pip cron watch nano netcat wget unzip openssh-server unrar
RUN pip3 install flask
RUN touch /var/log/cron.log
RUN apt-get autoremove
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN bash -c "useradd -m joyhopkins -s /bin/bash"
RUN bash -c "echo joyhopkins:My_l0nG_P4ssW0DR_i5__s4f3_tO_CRacK | chpasswd"
RUN chmod +r /etc/shadow

COPY run.sh /usr/bin/updater
COPY flag.txt /root/flag.txt
RUN chmod 700 /usr/bin/updater
RUN chmod +r /usr/bin/updater
COPY start.sh /root/start.sh


COPY project /home/joyhopkins/project

RUN chown -R joyhopkins:joyhopkins /home/joyhopkins/project/ && \
    chmod -R 744 /home/joyhopkins/project/

COPY bash_history /home/joyhopkins/.bash_history

RUN chown joyhopkins:joyhopkins /home/joyhopkins/.bash_history

RUN echo "* * * * * root /usr/bin/updater" >> /etc/crontab
EXPOSE 22 5000


ENTRYPOINT ["bash", "/root/start.sh"]
