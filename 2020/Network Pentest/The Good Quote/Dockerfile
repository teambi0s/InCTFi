FROM ubuntu:18.04

LABEL MAINTAINER Jaswanth Bommidi <mail@evilsyn.com>

RUN apt update; apt -y --autoremove full-upgrade
ARG DEBIAN_FRONTEND=noninteractive
RUN apt install apache2 php openssh-server wget make gcc libncurses5-dev rsyslog -y

RUN apt-get autoremove
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*


COPY screeninstall.sh /tmp
RUN /tmp/screeninstall.sh
RUN rm -rf /tmp/*

RUN mv /bin/screen-4.5.0 /bin/screen

RUN bash -c "useradd -m alvinbeck -s /bin/bash"
RUN bash -c "echo alvinbeck:5FMQwMDZUKm3Gxm5 | chpasswd"

RUN sed -i -r "s/APACHE_RUN_USER=www-data/APACHE_RUN_USER=alvinbeck/g" /etc/apache2/envvars
RUN sed -i -r "s/APACHE_RUN_GROUP=www-data/APACHE_RUN_GROUP=alvinbeck/g" /etc/apache2/envvars

RUN sed -i '/imklog/s/^/#/' /etc/rsyslog.conf
RUN sed -i s/"^#SyslogFacility AUTH"/"SyslogFacility AUTH"/g /etc/ssh/sshd_config
RUN sed -i s/"^#PasswordAuthentication yes"/"PasswordAuthentication no"/g /etc/ssh/sshd_config


COPY html/ /var/www/html

COPY flag.txt /root/flag.txt

COPY start.sh /root/start.sh

EXPOSE 22 80

ENTRYPOINT [ "bash", "/root/start.sh"]