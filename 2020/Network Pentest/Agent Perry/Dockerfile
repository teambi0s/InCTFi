FROM ubuntu:18.04

LABEL MAINTAINER Jaswanth Bommidi <mail@evilsyn.com>

RUN apt update; apt -y --autoremove full-upgrade
ARG DEBIAN_FRONTEND=noninteractive
RUN apt install vsftpd ftp sudo apache2 php php-mysqli mysql-server -y

RUN apt-get autoremove
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*


RUN mkdir -p /var/ftp/pub
RUN chmod 777 /var/ftp/pub
COPY flag.txt /root/flag.txt
COPY vsftpd.conf /etc/vsftpd.conf
COPY start.sh /root/start.sh

RUN bash -c "useradd -m evildoof -s /bin/bash"
RUN bash -c "useradd -m norm -s /bin/bash"


RUN bash -c "echo evildoof:EnuMeNKm4p8xMzhv2wfJKp | chpasswd"

COPY apache2.conf /etc/apache2/apache2.conf
RUN sed -i -r "s/APACHE_RUN_USER=www-data/APACHE_RUN_USER=norm/g" /etc/apache2/envvars
RUN sed -i -r "s/APACHE_RUN_GROUP=www-data/APACHE_RUN_GROUP=norm/g" /etc/apache2/envvars

RUN echo "norm ALL=(root) NOPASSWD: /bin/sed -i * /var/blueprints/*" >> /etc/sudoers

COPY evilbanking /var/www/html/
COPY evilbanking/dotgitfolder /var/www/html/.git

COPY dump.sql /var/www/html

COPY blueprints /var/blueprints/

RUN chown -R evildoof:evildoof /var/blueprints && \
   chmod -R 744 /var/blueprints

RUN chmod -R 777 /var/www/html

RUN sed -i "s/127.0.0.1/0.0.0.0/g" /etc/mysql/my.cnf


EXPOSE 8080 3306

ENTRYPOINT [ "bash", "/root/start.sh"]
